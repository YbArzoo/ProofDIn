<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProofdIn - Candidate Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #4a6cf7;
            --primary-dark: #3a56d4;
            --primary-light: #eef2ff;
            --secondary: #6c757d;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --border-radius: 8px;
            --box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        body {
            background-color: #f5f7fb;
            color: var(--dark);
            line-height: 1.6;
        }

        /* Header & Navigation */
        .dashboard-header {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            margin-left: 260px; 
        }

        .dashboard-nav {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 42px;
            height: 42px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 8px;
        }

        .logo-icon i {
            color: white;
            font-size: 1.3rem;
        }

        .logo-text {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .btn {
            padding: 0.6rem 1.5rem;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 1rem;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        /* Main Dashboard Layout */
        .dashboard-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
            margin-left: 260px;
            display: block;      
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            height: 100vh;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
            padding: 1.5rem 1rem;
            z-index: 1100;
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 2rem;
        }

        .sidebar-logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .sidebar-logo-icon i {
            color: white;
            font-size: 1.3rem;
        }

        .sidebar-logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .sidebar-nav {
            list-style: none;
            padding: 0;
        }

        .sidebar-nav-item {
            margin-bottom: 0.5rem;
        }

        .sidebar-nav-link {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 0.7rem 1rem;
            border-radius: 8px;
            color: var(--dark);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .sidebar-nav-link:hover,
        .sidebar-nav-link.active {
            background: var(--primary-light);
            color: var(--primary);
        }

        .sidebar-nav-link i {
            width: 20px;
            text-align: center;
        }

        .sidebar-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 0.8rem;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0.8rem 1rem;
            text-decoration: none;
            color: var(--secondary);
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background-color: var(--primary-light);
            color: var(--primary);
        }

        .sidebar-menu i {
            width: 20px;
            text-align: center;
        }

        /* Dashboard Main Content */
        .dashboard-main {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        /* Welcome Card */
        .welcome-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--box-shadow);
        }

        .welcome-card h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .welcome-card p {
            opacity: 0.9;
            margin-bottom: 1.5rem;
        }

        .welcome-stats {
            display: flex;
            gap: 2rem;
            margin-top: 1.5rem;
        }

        .stat {
            display: flex;
            flex-direction: column;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Section Cards */
        .section-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--box-shadow);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark);
        }

        .section-subtitle {
            color: var(--secondary);
            margin-bottom: 1.5rem;
        }

        /* Tailored Resume Section */
        .resume-tailor {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 1rem;
        }

        .job-input {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .job-input textarea {
            width: 100%;
            height: 150px;
            padding: 1rem;
            border: 1px solid #e0e0e0;
            border-radius: var(--border-radius);
            resize: vertical;
            font-size: 1rem;
        }

        .job-input textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .tailored-resume-preview {
            background-color: #f9f9f9;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            border: 1px dashed #ccc;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .tailored-resume-preview i {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        /* Skills Grid */
        .skills-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .skill-card {
            border: 1px solid #e0e0e0;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            transition: var(--transition);
        }

        .skill-card:hover {
            border-color: var(--primary);
            box-shadow: var(--box-shadow);
        }

        .skill-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .skill-name {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .skill-level {
            background-color: var(--primary-light);
            color: var(--primary);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .skill-details {
            color: var(--secondary);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .skill-last-used {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--secondary);
        }

        .skill-attachments {
            margin-top: 1rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .attachment-tag {
            background-color: #f0f0f0;
            padding: 0.3rem 0.8rem;
            border-radius: 4px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Skill Gaps Section */
        .skill-gaps {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 1rem;
        }

        .missing-skills-list {
            list-style: none;
        }

        .missing-skill {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #f0f0f0;
        }

        .missing-skill:last-child {
            border-bottom: none;
        }

        .practice-project {
            background-color: #f9f9f9;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .practice-project h4 {
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        /* Portfolio Section */
        .portfolio-settings {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 1rem;
        }

        .portfolio-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background-color: #f9f9f9;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        .privacy-controls {
            margin-top: 1.5rem;
        }

        .privacy-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid #f0f0f0;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .dashboard-container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .resume-tailor,
            .skill-gaps,
            .portfolio-settings {
                grid-template-columns: 1fr;
            }
            
            .skills-grid {
                grid-template-columns: 1fr;
            }
            
            .welcome-stats {
                flex-direction: column;
                gap: 1rem;
            }
            
            .dashboard-nav {
                flex-direction: column;
                gap: 1rem;
            }
        }
        #resume-content-display > :first-child {
            margin-top: 0 !important;
            padding-top: 0 !important;
        }

        #resume-content-display h1, 
        #resume-content-display h2, 
        #resume-content-display h3 {
            margin-top: 0.5rem; 
        }
        
        @media (max-width: 992px) {
            .sidebar {
                display: none; /* Hide sidebar on mobile/tablet */
            }
            .dashboard-header, 
            .dashboard-container {
                margin-left: 0; /* Reset margins so content is centered */
            }
        }
    </style>
</head>
<body>
    <!-- Dashboard Header -->
    <header class="dashboard-header">
        <nav class="dashboard-nav">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-search-check"></i>
                </div>
                <div class="logo-text">ProofdIn</div>
            </div>
            
            <div class="user-menu">
                <div class="user-profile">
                    <div class="avatar" id="user-avatar">JD</div>
                    <div>
                        <div id="user-name" style="font-weight: 600;">Candidate Name</div>
                        <div id="user-role" style="font-size: 0.9rem; color: var(--secondary);">Candidate</div>
                    </div>
                </div>
                <button class="btn btn-primary" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
            
        </nav>
    </header>

    <!-- Dashboard Content -->
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-logo">
                <div class="sidebar-logo-icon">
                    <i class="fas fa-search-check"></i>
                </div>
                <div class="sidebar-logo-text">ProofdIn</div>
            </div>

            <ul class="sidebar-nav sidebar-menu"> <li class="sidebar-nav-item">
                    <a href="#" class="sidebar-nav-link" onclick="window.scrollTo({top: 0, behavior: 'smooth'}); return false;">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </li>

                <li class="sidebar-nav-item">
                    <a href="#tailored-resume" class="sidebar-nav-link active">
                        <i class="fas fa-file-pdf"></i>
                        <span>Tailored Resumes</span>
                    </a>
                </li>

                <li class="sidebar-nav-item">
                    <a href="#skills-grid" class="sidebar-nav-link">
                        <i class="fas fa-th-large"></i>
                        <span>Skills Grid</span>
                    </a>
                </li>

                <li class="sidebar-nav-item">
                    <a href="#skill-proof" class="sidebar-nav-link">
                        <i class="fas fa-link"></i>
                        <span>Skill Proof</span>
                    </a>
                </li>

                <li class="sidebar-nav-item">
                    <a href="#skill-gaps" class="sidebar-nav-link">
                        <i class="fas fa-chart-line"></i>
                        <span>Skill Gaps</span>
                    </a>
                </li>

                <li class="sidebar-nav-item">
                    <a href="#portfolio" class="sidebar-nav-link">
                        <i class="fas fa-globe"></i>
                        <span>Portfolio</span>
                    </a>
                </li>

                <li class="sidebar-nav-item">
                    <a href="#settings" class="sidebar-nav-link">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </a>
                </li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="dashboard-main">
            <!-- Welcome Card -->
            <section class="welcome-card">
                <h1 id="welcome-heading">Welcome back!</h1>
                <p id="welcome-subtext">
                    Your resume is 85% optimized. Continue improving to increase your interview chances.
                </p>
                <div class="welcome-stats">
                    <div class="stat">
                        <div class="stat-value">12</div>
                        <div class="stat-label">Tailored Resumes</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">24</div>
                        <div class="stat-label">Skills Tracked</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">8</div>
                        <div class="stat-label">Projects Linked</div>
                    </div>
                </div>
            </section>
            

            <!-- Tailored Resume Section -->
            <section id="tailored-resume" class="section-card">
                <div class="section-header">
                    <h2 class="section-title">Tailored Resumes</h2>
                    <button class="btn btn-primary">
                        <i class="fas fa-download"></i> Download All
                    </button>
                </div>
                <p class="section-subtitle">One resume, many versions: Paste a job post to get a tailored PDF in 1 click.</p>
                
                <div class="resume-tailor">
                    <div class="job-input">
                        <textarea id="jd-input" placeholder="Paste the job description here..." style="min-height: 200px;"></textarea>
                        
                        <button id="generate-btn" class="btn btn-primary" onclick="generateResume()">
                            <i class="fas fa-magic"></i> Generate Tailored Resume
                        </button>
                    </div>
                    
                    <div id="success-card" class="tailored-resume-preview" style="display: none; border: 2px solid var(--primary-light); background: white;">
                        <i class="fas fa-file-pdf" style="font-size: 3rem; color: #dc3545; margin-bottom: 1rem;"></i>
                        <h3 id="generated-filename" style="margin-bottom: 0.5rem;">Resume.pdf</h3>
                        <p id="tailored-for" style="color: var(--secondary); margin-bottom: 0.5rem;">Tailored for: ...</p>
                        <p id="generated-date" style="font-size: 0.8rem; color: #999; margin-bottom: 1.5rem;">Generated: Just now</p>
                        
                        <div style="display: flex; gap: 1rem; width: 100%;">
                            <button class="btn btn-primary" style="flex: 1;" onclick="openPreviewModal()">
                                <i class="fas fa-eye"></i> Preview
                            </button>
                            <button class="btn" style="flex: 1; background-color: #f0f0f0; color: var(--dark);" onclick="downloadPDF()">
                                <i class="fas fa-download"></i> Download PDF
                            </button>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 2rem;">
                    <h3 style="margin-bottom: 1rem;">Recent Tailored Resumes</h3>
                    
                    <div id="recent-resumes-container" style="display: flex; gap: 1rem; overflow-x: auto; padding: 0.5rem 0;">
                        <p style="color: #888; font-style: italic;">Loading...</p>
                    </div>
                </div>

                <div id="history-modal" class="modal-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center;">
                    <div style="background: white; width: 500px; max-height: 80vh; border-radius: 8px; display: flex; flex-direction: column; box-shadow: 0 10px 25px rgba(0,0,0,0.2);">
                        <div style="padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
                            <h3 style="margin:0; font-size: 1.2rem;">All Resumes</h3>
                            <button onclick="closeHistoryModal()" style="border:none; background:none; font-size:1.5rem; cursor:pointer; color: #666;">&times;</button>
                        </div>
                        <div id="history-list" style="overflow-y: auto; padding: 0; flex: 1;">
                            </div>
                    </div>
                </div>

                <div id="preview-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center;">
                    <div style="background: white; width: 80%; max-width: 800px; height: 85%; padding: 25px; border-radius: 8px; position: relative; display: flex; flex-direction: column; box-shadow: 0 5px 15px rgba(0,0,0,0.3);">
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                            <h3 style="margin: 0;">Resume Preview</h3>
                            <button onclick="closePreviewModal()" style="border: none; background: transparent; font-size: 1.5rem; cursor: pointer; color: #666;">&times;</button>
                        </div>

                        <div id="resume-content-display" style="flex: 1; overflow-y: auto; font-family: 'Times New Roman', serif; padding: 20px; border: 1px solid #eee; background: #fff; color: #000; line-height: 1.5;">
                            </div>

                        <div style="margin-top: 15px; text-align: right; display: flex; justify-content: flex-end; gap: 10px;">
                            <button class="btn" style="background: #e0e0e0; color: #333;" onclick="closePreviewModal()">Close</button>
                            <button class="btn btn-primary" onclick="downloadPDF()">Download PDF</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Skills Grid Section -->
            <section id="skills-grid" class="section-card">
                <div class="section-header">
                    <h2 class="section-title">Skills Grid</h2>
                    <button class="btn btn-primary">
                        <i class="fas fa-plus"></i> Add Skill
                    </button>
                </div>
                <p class="section-subtitle">See your skills clearly: A grid shows each skill and when you last used it.</p>
                
                <div class="skills-grid">
                    <div class="skill-card">
                        <div class="skill-header">
                            <div class="skill-name">React</div>
                            <div class="skill-level">Expert</div>
                        </div>
                        <div class="skill-details">
                            JavaScript library for building user interfaces
                        </div>
                        <div class="skill-last-used">
                            <i class="far fa-calendar"></i>
                            <span>Last used: 2 weeks ago</span>
                        </div>
                        <div class="skill-attachments">
                            <span class="attachment-tag">
                                <i class="fas fa-link"></i> GitHub PR
                            </span>
                            <span class="attachment-tag">
                                <i class="fas fa-video"></i> Demo
                            </span>
                        </div>
                    </div>
                    
                    <div class="skill-card">
                        <div class="skill-header">
                            <div class="skill-name">TypeScript</div>
                            <div class="skill-level">Advanced</div>
                        </div>
                        <div class="skill-details">
                            Typed superset of JavaScript
                        </div>
                        <div class="skill-last-used">
                            <i class="far fa-calendar"></i>
                            <span>Last used: 1 week ago</span>
                        </div>
                        <div class="skill-attachments">
                            <span class="attachment-tag">
                                <i class="fas fa-certificate"></i> Certificate
                            </span>
                        </div>
                    </div>
                    
                    <div class="skill-card">
                        <div class="skill-header">
                            <div class="skill-name">Node.js</div>
                            <div class="skill-level">Intermediate</div>
                        </div>
                        <div class="skill-details">
                            JavaScript runtime for server-side development
                        </div>
                        <div class="skill-last-used">
                            <i class="far fa-calendar"></i>
                            <span>Last used: 1 month ago</span>
                        </div>
                        <div class="skill-attachments">
                            <span class="attachment-tag">
                                <i class="fas fa-link"></i> Live Project
                            </span>
                        </div>
                    </div>
                    
                    
                </div>
            </section>

            <!-- Skill Proof Section -->
            <section id="skill-proof" class="section-card">
                <div class="section-header">
                    <h2 class="section-title">Skill Proof</h2>
                    <button class="btn btn-primary">
                        <i class="fas fa-link"></i> Add Proof
                    </button>
                </div>
                <p class="section-subtitle">Prove what you know: Attach links to PRs, demos, or certificates for each skill.</p>
                
                <div style="margin-top: 1.5rem;">
                    <div class="skill-card" style="margin-bottom: 1rem;">
                        <div class="skill-header">
                            <div class="skill-name">React Performance Optimization</div>
                            <div class="skill-level">Proof Added</div>
                        </div>
                        <div class="skill-details">
                            Reduced bundle size by 40% and improved Lighthouse score from 65 to 95
                        </div>
                        <div class="skill-attachments" style="margin-top: 1rem;">
                            <span class="attachment-tag" style="background-color: #e8f5e9; color: #2e7d32;">
                                <i class="fab fa-github"></i> GitHub PR #245
                            </span>
                            <span class="attachment-tag" style="background-color: #e3f2fd; color: #1565c0;">
                                <i class="fas fa-chart-line"></i> Performance Report
                            </span>
                            <span class="attachment-tag" style="background-color: #f3e5f5; color: #7b1fa2;">
                                <i class="fas fa-video"></i> Demo Video
                            </span>
                        </div>
                    </div>
                    
                    <div class="skill-card">
                        <div class="skill-header">
                            <div class="skill-name">TypeScript Migration</div>
                            <div class="skill-level">Proof Added</div>
                        </div>
                        <div class="skill-details">
                            Successfully migrated 15K lines of JavaScript to TypeScript
                        </div>
                        <div class="skill-attachments" style="margin-top: 1rem;">
                            <span class="attachment-tag" style="background-color: #e8f5e9; color: #2e7d32;">
                                <i class="fab fa-github"></i> GitHub PR #189
                            </span>
                            <span class="attachment-tag" style="background-color: #fff8e1; color: #ff8f00;">
                                <i class="fas fa-file-code"></i> Migration Guide
                            </span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Skill Gaps Section -->
            <section id="skill-gaps" class="section-card">
                <div class="section-header">
                    <h2 class="section-title">Skill Gaps</h2>
                    <button class="btn btn-primary">
                        <i class="fas fa-sync-alt"></i> Re-analyze
                    </button>
                </div>
                <p class="section-subtitle">Close the gaps: AI suggests missing skills and tiny practice projects to learn them.</p>
                
                <div class="skill-gaps">
                    <div>
                        <h3 style="margin-bottom: 1rem;">Missing Skills for "Senior Frontend Developer"</h3>
                        <ul class="missing-skills-list">
                            <li class="missing-skill">
                                <div>
                                    <div style="font-weight: 600;">GraphQL</div>
                                    <div style="font-size: 0.9rem; color: var(--secondary);">Required by 65% of senior roles</div>
                                </div>
                                <button class="btn" style="padding: 0.3rem 0.8rem; font-size: 0.9rem;">
                                    Learn
                                </button>
                            </li>
                            <li class="missing-skill">
                                <div>
                                    <div style="font-weight: 600;">WebSocket</div>
                                    <div style="font-size: 0.9rem; color: var(--secondary);">Required by 45% of senior roles</div>
                                </div>
                                <button class="btn" style="padding: 0.3rem 0.8rem; font-size: 0.9rem;">
                                    Learn
                                </button>
                            </li>
                            <li class="missing-skill">
                                <div>
                                    <div style="font-weight: 600;">Jest Advanced Testing</div>
                                    <div style="font-size: 0.9rem; color: var(--secondary);">Required by 70% of senior roles</div>
                                </div>
                                <button class="btn" style="padding: 0.3rem 0.8rem; font-size: 0.9rem;">
                                    Learn
                                </button>
                            </li>
                        </ul>
                    </div>
                    
                    <div>
                        <h3 style="margin-bottom: 1rem;">Recommended Practice Projects</h3>
                        <div class="practice-project">
                            <h4>Build a Real-time Chat App</h4>
                            <p>Practice WebSocket and real-time data handling. Estimated time: 4-6 hours.</p>
                            <button class="btn btn-primary" style="margin-top: 0.5rem; padding: 0.5rem 1rem;">
                                Start Project
                            </button>
                        </div>
                        <div class="practice-project">
                            <h4>Create a GraphQL API</h4>
                            <p>Learn GraphQL queries, mutations, and subscriptions. Estimated time: 3-5 hours.</p>
                            <button class="btn btn-primary" style="margin-top: 0.5rem; padding: 0.5rem 1rem;">
                                Start Project
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Portfolio Section -->
            <section id="portfolio" class="section-card">
                <div class="section-header">
                    <h2 class="section-title">Portfolio Showcase</h2>
                    <button class="btn btn-primary">
                        <i class="fas fa-external-link-alt"></i> View Portfolio
                    </button>
                </div>
                <p class="section-subtitle">Showcase safely: Optional public portfolio page, with privacy controls for what's shown.</p>
                
                <div class="portfolio-settings">
                    <div>
                        <div class="portfolio-toggle">
                            <div>
                                <div style="font-weight: 600;">Public Portfolio</div>
                                <div style="font-size: 0.9rem; color: var(--secondary);">Your portfolio is currently public</div>
                            </div>
                            <label class="switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div class="privacy-controls">
                            <h4 style="margin-bottom: 1rem;">Privacy Controls</h4>
                            <div class="privacy-item">
                                <div>
                                    <div style="font-weight: 600;">Show Contact Information</div>
                                    <div style="font-size: 0.9rem; color: var(--secondary);">Email and phone number</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="privacy-item">
                                <div>
                                    <div style="font-weight: 600;">Show Current Employer</div>
                                    <div style="font-size: 0.9rem; color: var(--secondary);">Your current company</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="privacy-item">
                                <div>
                                    <div style="font-weight: 600;">Show Skill Proof Links</div>
                                    <div style="font-size: 0.9rem; color: var(--secondary);">GitHub, demos, certificates</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background-color: #f9f9f9; border-radius: var(--border-radius); padding: 1.5rem;">
                        <h4 style="margin-bottom: 1rem;">Portfolio Preview</h4>
                        <div style="background-color: white; border-radius: var(--border-radius); padding: 1.5rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div class="avatar" style="width: 60px; height: 60px; font-size: 1.5rem;">JD</div>
                                <div>
                                    <div style="font-weight: 700; font-size: 1.2rem;">Nafisaa</div>
                                    <div style="color: var(--secondary);">Senior Frontend Developer</div>
                                </div>
                            </div>
                            <p style="margin-bottom: 1rem;">5+ years of experience in building scalable web applications with React and TypeScript.</p>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem;">
                                <span style="background-color: var(--primary-light); color: var(--primary); padding: 0.3rem 0.8rem; border-radius: 4px; font-size: 0.9rem;">React</span>
                                <span style="background-color: var(--primary-light); color: var(--primary); padding: 0.3rem 0.8rem; border-radius: 4px; font-size: 0.9rem;">TypeScript</span>
                                <span style="background-color: var(--primary-light); color: var(--primary); padding: 0.3rem 0.8rem; border-radius: 4px; font-size: 0.9rem;">Node.js</span>
                            </div>
                            <div style="font-size: 0.9rem; color: var(--secondary);">
                                <i class="fas fa-eye"></i> 245 views this month
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
    const API_BASE_URL = "http://localhost:5000"; 
    let allResumes = []; 
    let generatedResumeHTML = ""; 

    document.addEventListener('DOMContentLoaded', () => {
        checkAuth();
        fetchResumeHistory();
    });

    // --- FETCH HISTORY ---
    async function fetchResumeHistory() {
        try {
            const token = localStorage.getItem('token');
            const res = await fetch(`${API_BASE_URL}/api/candidate/resumes`, {
                headers: { 'x-auth-token': token }
            });
            const data = await res.json();
            if (res.ok) {
                allResumes = data;
                renderRecentResumes();
            }
        } catch (err) {
            console.error(err);
        }
    }

    // --- RENDER RECENT LIST (UPDATED TITLES) ---
    function renderRecentResumes() {
        const container = document.getElementById('recent-resumes-container');
        if (!container) return;
        container.innerHTML = ''; 

        if (allResumes.length === 0) {
            container.innerHTML = '<p style="color: #888; font-style: italic; padding: 5px;">No resumes generated yet.</p>';
            return;
        }

        const recent = allResumes.slice(0, 3);

        recent.forEach(resume => {
            const date = new Date(resume.createdAt).toLocaleDateString();
            
            // FIX: Use Job Title as main text
            const displayTitle = resume.jobTitle ? `${resume.jobTitle}.pdf` : 'Tailored Resume.pdf';
            const displaySub = resume.companyName || 'Target Company';

            const card = document.createElement('div');
            card.className = 'tailored-resume-preview';
            card.style.minWidth = '200px';
            card.style.cursor = 'pointer';
            card.style.border = '1px solid #eee';
            
            card.onclick = () => loadResumeIntoPreview(resume); 

            card.innerHTML = `
                <i class="fas fa-file-pdf" style="font-size: 2rem; margin-bottom: 0.5rem; color: #dc3545;"></i>
                
                <div style="font-weight: 600; font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 180px;">
                    ${displayTitle}
                </div>
                
                <div style="font-size: 0.8rem; color: #666; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 180px;">
                    ${displaySub}
                </div>
                
                <div style="font-size: 0.7rem; color: #999; margin-top: 5px;">${date}</div>
            `;
            container.appendChild(card);
        });

        if (allResumes.length > 3) {
            const viewMore = document.createElement('div');
            viewMore.className = 'tailored-resume-preview';
            viewMore.style.minWidth = '100px';
            viewMore.style.cursor = 'pointer';
            viewMore.style.border = '1px dashed var(--primary)';
            viewMore.style.backgroundColor = '#f0f7ff';
            viewMore.onclick = openHistoryModal;
            viewMore.innerHTML = `
                <i class="fas fa-arrow-right" style="color: var(--primary); font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                <div style="color: var(--primary); font-weight: 600; font-size: 0.9rem;">View All</div>
                <div style="color: var(--primary); font-size: 0.8rem;">(${allResumes.length})</div>
            `;
            container.appendChild(viewMore);
        }
    }

    // --- GENERATE RESUME (UPDATED SUCCESS CARD LOGIC) ---
    async function generateResume() {
        const jdInput = document.getElementById('jd-input');
        const btn = document.getElementById('generate-btn'); 
        const jdText = jdInput.value;

        if (!jdText || jdText.trim().length < 20) return alert('Please enter a valid JD.');

        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
        btn.disabled = true;

        try {
            const token = localStorage.getItem('token');
            const response = await fetch(`${API_BASE_URL}/api/candidate/generate-resume`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'x-auth-token': token },
                body: JSON.stringify({ jobDescriptionText: jdText })
            });
            const data = await response.json();

            if (!response.ok) throw new Error(data.message || 'Server Error');

            // 1. Prepare Content
            generatedResumeHTML = marked.parse(data.resumeContent);
            let printArea = document.getElementById('resume-content-display');
            if (!printArea) {
                printArea = document.createElement('div');
                printArea.id = 'resume-content-display';
                printArea.style.display = 'none';
                document.body.appendChild(printArea);
            }
            printArea.innerHTML = generatedResumeHTML;

            // 2. SHOW THE SUCCESS CARD (Restoring the "Picture 1" look)
            const successCard = document.getElementById('success-card');
            const filenameEl = document.getElementById('generated-filename');
            const tailorEl = document.getElementById('tailored-for');
            const dateEl = document.getElementById('generated-date');

            if (successCard) {
                successCard.style.display = 'flex'; // Make it visible
                successCard.style.flexDirection = 'column'; // Ensure vertical alignment
                
                // Update text
                filenameEl.textContent = data.jobTitle ? `${data.jobTitle}.pdf` : 'Tailored Resume.pdf';
                tailorEl.textContent = `Tailored for: ${data.companyName || 'Target Company'}`;
                dateEl.textContent = `Generated: Just now`;
            }

            // 3. Refresh History List
            fetchResumeHistory();
            
            alert('✅ Resume Generated Successfully!');

        } catch (error) {
            alert('Failed: ' + error.message);
        } finally {
            btn.innerHTML = originalText;
            btn.disabled = false;
        }
    }

    // --- LOAD PREVIEW FROM HISTORY ---
    function loadResumeIntoPreview(resume) {
        generatedResumeHTML = marked.parse(resume.content);
        
        // Update Print Area
        let printArea = document.getElementById('resume-content-display');
        if (!printArea) {
            printArea = document.createElement('div');
            printArea.id = 'resume-content-display';
            printArea.style.display = 'none';
            document.body.appendChild(printArea);
        }
        printArea.innerHTML = generatedResumeHTML;
        
        // Open Modal directly
        openPreviewModal();
    }

    // --- MODAL & DOWNLOAD FUNCTIONS ---
    function openPreviewModal() {
        if (!generatedResumeHTML) { alert("No resume loaded."); return; }
        const modalBody = document.getElementById('modal-content-body');
        if(modalBody) modalBody.innerHTML = generatedResumeHTML;
        document.getElementById('preview-modal').style.display = 'flex';
    }
    
    function closePreviewModal() {
        document.getElementById('preview-modal').style.display = 'none';
    }

    function openHistoryModal() {
        const list = document.getElementById('history-list');
        list.innerHTML = '';
        
        allResumes.forEach(resume => {
            const date = new Date(resume.createdAt).toLocaleString();
            const item = document.createElement('div');
            item.style.padding = '1rem';
            item.style.borderBottom = '1px solid #eee';
            item.style.display = 'flex';
            item.style.justifyContent = 'space-between';
            item.style.alignItems = 'center';
            item.style.cursor = 'pointer';
            
            item.onmouseover = () => { item.style.backgroundColor = '#f9f9f9'; };
            item.onmouseout = () => { item.style.backgroundColor = 'transparent'; };
            
            // FIX: Use Job Title in History List too
            item.innerHTML = `
                <div>
                    <div style="font-weight:700; color: #333;">${resume.jobTitle || 'Tailored Resume'}</div>
                    <div style="font-size:0.8rem; color:#666;">${resume.companyName} • ${date}</div>
                </div>
                <button class="btn btn-primary" style="padding: 0.4rem 0.8rem; font-size: 0.8rem;">View</button>
            `;
            
            item.onclick = () => {
                closeHistoryModal();
                loadResumeIntoPreview(resume);
            };
            list.appendChild(item);
        });

        document.getElementById('history-modal').style.display = 'flex';
    }

    function closeHistoryModal() {
        document.getElementById('history-modal').style.display = 'none';
    }

    function downloadPDF() {
        const element = document.getElementById('resume-content-display');
        const opt = { 
            margin: [0.5, 0.5], 
            filename: 'Tailored_Resume.pdf', 
            html2canvas: { scale: 2, scrollY: 0 }, 
            jsPDF: { unit: 'in', format: 'letter' } 
        };
        element.style.display = 'block'; 
        element.style.padding = '20px';
        html2pdf().set(opt).from(element).save().then(() => element.style.display = 'none');
    }
    
    window.onclick = function(event) {
        if (event.target === document.getElementById('preview-modal')) closePreviewModal();
        if (event.target === document.getElementById('history-modal')) closeHistoryModal();
    }

    function checkAuth() {
        const token = localStorage.getItem('token');
        const user = JSON.parse(localStorage.getItem('user'));
        if (!token || !user || user.role !== 'candidate') {
            window.location.href = 'login.html';
        } else {
            document.getElementById('user-name').textContent = user.fullName;
            if(user.fullName) document.getElementById('user-avatar').textContent = user.fullName.charAt(0).toUpperCase();
            
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
                    localStorage.clear();
                    window.location.href = 'login.html';
                });
            }
        }
    }
</script>
</body>
</html>